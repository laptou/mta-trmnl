---
import Layout from "../../layouts/Layout.astro";
import { getStation, getUpcomingArrivals } from "../../util/mta";

const { id } = Astro.params;
const station = await getStation(id!);

if (!station) {
    return Astro.redirect("/404");
}

const arrivals = await getUpcomingArrivals(station.stopId);
const arrivalsNorth = arrivals.filter((a) => a.stopId === `${station.stopId}N`);
const arrivalsSouth = arrivals.filter((a) => a.stopId === `${station.stopId}S`);
---

<Layout>
    <div class="container mx-auto px-4 py-8">
        <div class="mb-8">
            <a href="/" class="text-blue-500 hover:underline"
                >&larr; Back to Lines</a
            >
        </div>

        <h1 class="text-4xl font-bold mb-8">{station.stopName}</h1>

        <div class="grid grid-cols-2 gap-4">
            <div>
                <h3 class="font-semibold mb-2">Uptown</h3>
                {
                    arrivalsNorth.length > 0 ? (
                        <ul class="space-y-1">
                            {arrivalsNorth.map((arrival) => (
                                <li>
                                    {arrival.line}{" "}
                                    {arrival.departureTime.toString()}
                                </li>
                            ))}
                        </ul>
                    ) : (
                        <p class="text-gray-500">No upcoming trains</p>
                    )
                }
            </div>
            <div>
                <h3 class="font-semibold mb-2">Downtown</h3>
                {
                    arrivalsSouth.length > 0 ? (
                        <ul class="space-y-1">
                            {arrivalsSouth.map((arrival) => (
                                <li>
                                    {arrival.line}{" "}
                                    {arrival.departureTime.toString()}
                                </li>
                            ))}
                        </ul>
                    ) : (
                        <p class="text-gray-500">No upcoming trains</p>
                    )
                }
            </div>
        </div>
    </div>
</Layout>
